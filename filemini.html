<canvas id="c" width="500" height="500" oncontextmenu="return false;" style="image-rendering: pixelated;">
<script>
var t=document.getElementById("c"),e=t.width,n=t.height,r=150,o=t.getContext("2d"),l=o.getImageData(0,0,e,n),a=1,i=-1,d=0,f=4,c=0,u=0,g=!0,h=6,s=5,m=255,w=[[[0,0,0],[m,m,m]],[[66,30,15],[25,7,26],[0,7,100],[m,m,m],[m,201,95],[106,52,3]],[[0,0,128],[165,205,m],[100,149,237],[176,224,m],[0,191,m]],[[m,0,m],[0,m,m],[m,m,0],[m,165,0],[m,130,m],[m,20,147],[0,m,127]],[[0,0,0],[m,113,38],[m,195,154],[m,m,54],[63,63,116]]];function y(){let t=new Array(e);for(let r=0;r<e;r++)t[r]=new Array(n);for(let r=0;r<e;r++)for(let e=0;e<n;e++)t[r][e]=r%f==0||e%f==0?k(r,e):-1;f=32*h;for(let r=0;r<6;r++){for(let r=0;r<e;r++)for(let o=0;o<n;o++)if(r%f==0&&o%f==0&&r<e-f){let l=t[r][o],a=!0;for(let e=0;e<f;e++)if(t[r][o+e]!==l||t[r+f][o+e]!==l||t[r+e][o]!==l||t[r+e][o+f]!==l){a=!1;break}if(a)for(let a=0;a<f;a++)for(let i=0;i<f;i++)r+a<e&&o+i<n&&(t[r+a][o+i]=l)}f/=2}for(let o=0;o<e;o++)for(let e=0;e<n;e++){let n=-1==t[o][e]?k(o,e):t[o][e],l=m-n*m/r,[a,i,d]=E(l);p(e,o,n==r?0:a,n==r?0:i,n==r?0:d)}o.putImageData(l,0,0)}function k(t,o){let l=t/e*4/a-2/a+i,f=o/n*4/a-2/a+d,h=g?0:c,s=g?0:u,m=0;for(;(g?h*h+s*s:l*l+f*f)<=4&&m<r;)g?[h,s]=[h*h-s*s+l,2*h*s+f]:[l,f]=[l*l-f*f+h,2*l*f+s],m++;return m}function p(t,n,r,o,a){let i=4*(t*e+n);l.data.set([r,o,a,m],i)}function v(r){let o=t.getBoundingClientRect();return[(r.clientX-o.left)/e*4/a-2/a+i,(r.clientY-o.top)/n*4/a-2/a+d]}function E(t){if(s>=w.length)return[1,2,3].map((e=>Math.round(m*(Math.abs((t/60+2*e)%6-3)-1))));let e=w[s],n=t/m*(e.length-1),[r,o]=[Math.floor(n),Math.ceil(n)],l=n-r,[a,i,d]=e[r],[f,c,u]=e[o];return[a+l*(f-a),i+l*(c-i),d+l*(u-d)]}y(),t.addEventListener("click",(t=>{[i,d]=v(t),a*=1.7,r+=50,y()})),t.addEventListener("auxclick",(t=>{1===t.button?([c,u]=v(t),g=!1):([i,d]=v(t),a/=1.7,r-=50),y()})),document.addEventListener("keydown",(r=>{if("Space"===r.code&&(c=u=0,g=!0,y()),r.code.startsWith("Digit")&&(h=parseInt(r.code[5]))>0){let r=100*h;t.width=t.height=e=n=r,l=o.getImageData(0,0,e,n),y()}})),document.addEventListener("keydown",(t=>{"KeyP"===t.code&&(s=(s+1)%(w.length+1),y())}));
</script>